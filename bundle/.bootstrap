#!/usr/bin/env bash

OS=$(uname -s | tr '[:upper:]' '[:lower:]')
case "$(uname -m)" in
  'x86_64')
    ARCH="amd64"
    ;;
  'arm64')
    ARCH="arm64"
    ;;
  *)
    ARCH="386"
    ;;
esac

if [ -z "$TMPDIR" ]; then
  TMPDIR=/tmp
fi

if [ -n "$GOVERSION" ]; then
  arch=$ARCH
  [ "$OS" = "darwin" ] && arch="amd64" # for rosetta2
  GOSDK=go$GOVERSION.$OS-$arch
  if [ -z "$GOROOT" ]; then
      GOROOT=$HOME/go
  fi
  echo $GOSDK
  GOROOT_PATH=${GOROOT%/*}
  GOROOT_DIRNAME=${GOROOT##*/}
  if [ ! -d "$GOROOT" ]; then
    echo Installing $GOSDK
    curl -sS https://dl.google.com/go/$GOSDK.tar.gz > $TMPDIR/$GOSDK.tar.gz
    tar -C $GOROOT_PATH -xzf $TMPDIR/$GOSDK.tar.gz
    if [ ! $GOROOT_DIRNAME = "go" ]; then
      mv $GOROOT_PATH/go $GOROOT
    fi
  else
    echo go is installed in $GOROOT_PATH
  fi
fi

if which go > /dev/null 2>&1; then
  which ghq > /dev/null 2>&1 \
    || go get -v -u github.com/x-motemen/ghq
  which gomodifytags > /dev/null 2>&1 \
    || go get -v -u github.com/fatih/gomodifytags
  which mmv > /dev/null 2>&1 \
    || go get -v -u github.com/itchyny/mmv/cmd/mmv
  which gof > /dev/null 2>&1 \
    || go get -v -u github.com/mattn/gof
  which cho > /dev/null 2>&1 \
    || go get -v -u github.com/mattn/cho
fi

if which npm > /dev/null 2>&1; then
  which yarn > /dev/null 2>&1 \
    || npm i -g yarn
  which gitmoji-cli > /dev/null 2>&1 \
    || npm i -g gitmoji-cli
  which npm-check-updates > /dev/null 2>&1 \
    || npm i -g npm-check-updates
fi
